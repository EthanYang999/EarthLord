# EarthLord 产品需求文档 (PRD)

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | EarthLord（领地开拓者） |
| 文档版本 | v1.0 |
| 创建日期 | 2025-12-23 |
| 产品类型 | LBS生存策略手游 |
| 目标平台 | iOS |

---

## 1. 产品概述

### 1.1 产品定位

EarthLord是一款基于真实地理位置的末日生存策略游戏，玩家通过真实行走圈占领地、探索废墟搜刮资源、建造设施发展基地，并与其他玩家进行交易和社交互动。

### 1.2 产品愿景

"用脚步丈量你的王国"——让玩家在现实世界中行走探索，在虚拟世界中建立自己的末日帝国。

### 1.3 目标用户

| 用户类型 | 特征描述 |
|---------|---------|
| 核心用户 | 18-35岁，喜欢户外运动和策略游戏的玩家 |
| 次要用户 | 喜欢末日生存题材、收集养成类游戏的玩家 |
| 潜在用户 | 想要通过游戏化方式激励自己运动的用户 |

### 1.4 产品目标

- **用户增长**：上线首月达到10万注册用户
- **用户留存**：次日留存率≥40%，7日留存率≥20%
- **商业目标**：月活付费率≥5%，ARPPU≥$15

---

## 2. 功能需求

### 2.1 用户系统

#### 2.1.1 登录注册

**功能描述**：支持多种登录方式，为用户提供便捷的账号体系

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| AUTH-001 | 邮箱注册 | P0 | 用户通过邮箱+密码完成注册 |
| AUTH-002 | Apple登录 | P0 | 支持Sign in with Apple一键登录 |
| AUTH-003 | Google登录 | P0 | 支持Google账号一键登录 |
| AUTH-004 | 密码重置 | P1 | 通过邮箱验证重置密码 |
| AUTH-005 | 会话管理 | P0 | 支持多设备登录，Token自动刷新 |

**技术方案**：Supabase Auth

---

### 2.2 圈地系统

#### 2.2.1 GPS圈地

**功能描述**：玩家通过真实行走，在地图上绘制轨迹并圈占领地

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| LAND-001 | 开始圈地 | P0 | 点击开始后记录GPS轨迹 |
| LAND-002 | 轨迹绘制 | P0 | 实时在地图上显示行走轨迹（蓝色线） |
| LAND-003 | 轨迹闭合 | P0 | 回到起点附近（50m内）自动闭合 |
| LAND-004 | 合法性验证 | P0 | 检测是否与他人领地重叠、是否作弊 |
| LAND-005 | 领地生成 | P0 | 验证通过后生成绿色多边形领地 |
| LAND-006 | 面积计算 | P0 | 精确计算领地面积（平方米） |

**业务规则**：
- 最小圈地面积：100平方米
- 最大单次圈地面积：50,000平方米
- 领地不可与他人领地重叠
- 必须在30天内开始建设，90天内保持活跃

**技术方案**：Apple MapKit + CoreLocation + PostGIS

#### 2.2.2 领地管理

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| LAND-010 | 领地命名 | P1 | 为领地设置自定义名称 |
| LAND-011 | 领地详情 | P0 | 查看面积、建筑数量、状态等信息 |
| LAND-012 | 交易开关 | P1 | 控制是否允许该领地内进行交易 |
| LAND-013 | 领地列表 | P0 | 查看所有拥有的领地 |

---

### 2.3 探索系统

#### 2.3.1 POI发现与搜刮

**功能描述**：玩家在现实世界移动时，发现并搜刮附近的兴趣点获取资源

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| POI-001 | POI检测 | P0 | 基于GPS检测玩家进入POI范围（100m） |
| POI-002 | POI分类 | P0 | 根据真实地标类型分类（医院、超市等） |
| POI-003 | 搜刮操作 | P0 | 点击搜刮获取对应资源 |
| POI-004 | 资源映射 | P0 | 不同POI类型产出不同资源 |
| POI-005 | 冷却机制 | P1 | 同一POI搜刮后需等待冷却（4小时） |

**POI资源映射表**：

| POI类型 | 产出资源 |
|---------|---------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

**技术方案**：Apple MapKit POI Search + 地理围栏

---

### 2.4 资源管理

#### 2.4.1 背包系统

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| BAG-001 | 背包容量 | P0 | 默认100格，可通过建造仓库扩容 |
| BAG-002 | 物品查看 | P0 | 查看所有物品及数量 |
| BAG-003 | 物品使用 | P0 | 消耗类物品可直接使用 |
| BAG-004 | 分类筛选 | P1 | 按类型筛选物品 |
| BAG-005 | 离线同步 | P1 | 本地优先架构，离线可用 |

**物品分类**：
- 食物类：罐头食品、饮用水、新鲜食物
- 药品类：急救包、抗生素、维生素
- 材料类：木材、石头、金属、布料
- 特殊类：卫星模块、电子元件

---

### 2.5 建造系统

#### 2.5.1 建筑建造

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| BUILD-001 | 建筑列表 | P0 | 查看可建造的建筑及需求资源 |
| BUILD-002 | 资源检查 | P0 | 检测背包资源是否满足建造需求 |
| BUILD-003 | 位置选择 | P0 | 在领地内选择建造位置 |
| BUILD-004 | 建造执行 | P0 | 扣除资源，开始建造 |
| BUILD-005 | 建造进度 | P1 | 显示建造倒计时 |

**建筑分类**：

| 分类 | 建筑示例 | 功能 |
|------|---------|------|
| 生存类 | 篝火、庇护所 | 取暖、休息 |
| 储存类 | 小仓库、中仓库 | 扩展背包容量 |
| 生产类 | 农田、工作台 | 生产资源 |
| 能源类 | 太阳能板、风力发电机 | 提供能源 |

#### 2.5.2 建筑状态管理

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| BUILD-010 | 状态流转 | P0 | 建造中→待激活→运行中→损坏 |
| BUILD-011 | 建筑升级 | P1 | 消耗资源提升建筑等级 |
| BUILD-012 | 建筑维修 | P1 | 修复损坏的建筑 |
| BUILD-013 | 建筑拆除 | P2 | 拆除建筑回收部分资源 |

---

### 2.6 交易系统

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| TRADE-001 | 发布挂单 | P0 | 设置"我提供"和"我需要"的物品 |
| TRADE-002 | 查看挂单 | P0 | 查看附近（100m内）的交易挂单 |
| TRADE-003 | 接受交易 | P0 | 接受他人挂单完成交易 |
| TRADE-004 | 取消挂单 | P1 | 撤销自己发布的挂单 |
| TRADE-005 | 交易历史 | P2 | 查看历史交易记录 |

**业务规则**：
- 需要进入对方领地100米范围内才能看到挂单
- 领地"允许交易"开关需打开

---

### 2.7 通讯系统

#### 2.7.1 消息中心

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| MSG-001 | 官方消息 | P0 | 接收系统公告、活动通知 |
| MSG-002 | 生存指南 | P1 | 新手引导消息 |
| MSG-003 | 每日任务 | P1 | 每日任务推送 |
| MSG-004 | 消息已读 | P1 | 标记消息已读状态 |

#### 2.7.2 公共频道聊天

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| CHAT-001 | 范围限制 | P0 | 3km范围内玩家可见消息 |
| CHAT-002 | 实时消息 | P0 | 消息实时推送，无需刷新 |
| CHAT-003 | 发送消息 | P0 | 发送文字消息 |
| CHAT-004 | 消息历史 | P1 | 查看历史消息记录 |

**技术方案**：Supabase Realtime

#### 2.7.3 频道管理

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| CHAN-001 | 创建频道 | P1 | 创建私人/公开频道 |
| CHAN-002 | 加入频道 | P1 | 搜索并加入频道 |
| CHAN-003 | 退出频道 | P1 | 退出已加入的频道 |
| CHAN-004 | 频道聊天 | P1 | 在频道内发送消息 |

#### 2.7.4 PTT呼叫

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| PTT-001 | 长按发送 | P1 | 长按麦克风按钮发送语音/文字 |
| PTT-002 | 频率切换 | P2 | 切换不同频率频道 |

#### 2.7.5 设备等级

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| DEV-001 | 设备限制 | P1 | 不同设备有不同功能限制 |
| DEV-002 | 设备升级 | P1 | 消耗资源/付费升级设备 |

**设备等级**：

| 设备 | 功能 | 范围 |
|------|------|------|
| 收音机 | 只收不发 | - |
| 对讲机 | 收发 | 3km |
| 营地电台 | 收发 | 10km |
| 卫星通讯 | 收发 | 全球 |

---

### 2.8 个人中心

#### 2.8.1 个人主页

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| PROF-001 | 基础信息 | P0 | 显示等级、存活天数 |
| PROF-002 | 资产统计 | P0 | 领地数量、总面积、建筑数量 |
| PROF-003 | 头像昵称 | P1 | 设置个人头像和昵称 |

#### 2.8.2 生存体征

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| VITAL-001 | 核心生命 | P0 | 显示生命值（0-100） |
| VITAL-002 | 饱食度 | P0 | 显示饥饿值，每小时-5 |
| VITAL-003 | 水分 | P0 | 显示口渴值，每小时-10 |
| VITAL-004 | 状态增益 | P1 | 饱食度/水分>80%时获得增益 |
| VITAL-005 | 消耗食物 | P0 | 使用食物恢复饱食度 |
| VITAL-006 | 消耗水 | P0 | 使用饮用水恢复水分 |

#### 2.8.3 成就系统

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| ACH-001 | 成就列表 | P1 | 显示所有成就及完成状态 |
| ACH-002 | 成就检测 | P1 | 自动检测成就完成条件 |
| ACH-003 | 奖励发放 | P1 | 完成成就发放金币奖励 |
| ACH-004 | 稀有度分级 | P2 | 普通/稀有/史诗/传说 |

#### 2.8.4 排行榜

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| RANK-001 | 领地面积榜 | P1 | 按总领地面积排名 |
| RANK-002 | 探索废墟榜 | P1 | 按探索次数排名 |
| RANK-003 | 建筑数量榜 | P1 | 按建筑数量排名 |
| RANK-004 | 个人排名 | P1 | 显示自己在各榜的排名 |

---

### 2.9 商业化系统

#### 2.9.1 付费订阅

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| PAY-001 | 开拓者月卡 | P0 | $9.99/月，无限探索、范围扩大 |
| PAY-002 | 领主通行证 | P0 | $19.99/月，全部特权 |
| PAY-003 | 订阅管理 | P0 | 查看订阅状态、续费、取消 |

#### 2.9.2 内购道具

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| IAP-001 | 初级物资包 | P0 | $0.99一次性购买 |
| IAP-002 | 中级物资包 | P0 | $2.99一次性购买 |
| IAP-003 | 高级物资包 | P0 | $9.99一次性购买 |
| IAP-004 | 购买确认 | P0 | 支付前二次确认 |
| IAP-005 | 恢复购买 | P0 | 恢复已购买的内容 |

**技术方案**：StoreKit 2

---

### 2.10 多语言支持

| 需求ID | 功能点 | 优先级 | 描述 |
|--------|-------|--------|------|
| I18N-001 | 简体中文 | P0 | 默认语言 |
| I18N-002 | 繁体中文 | P1 | 支持繁体中文 |
| I18N-003 | English | P0 | 支持英文 |
| I18N-004 | 语言切换 | P0 | 设置中切换语言，重启生效 |

---

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 |
|------|------|
| 启动时间 | 冷启动≤3秒 |
| GPS响应 | 位置更新延迟≤1秒 |
| 消息延迟 | 实时消息延迟≤500ms |
| 排行榜查询 | ≤1秒返回结果 |

### 3.2 安全需求

- 用户密码加密存储
- OAuth令牌安全管理
- 防止GPS作弊（速度检测、轨迹异常检测）
- 交易防刷机制

### 3.3 可用性需求

- 本地优先架构，支持离线使用核心功能
- 网络恢复后自动同步数据
- 错误信息友好提示

---

## 4. 技术架构

### 4.1 技术栈

| 层级 | 技术选型 |
|------|---------|
| 前端 | SwiftUI + iOS 17+ |
| 地图 | Apple MapKit |
| 定位 | CoreLocation |
| 后端 | Supabase (PostgreSQL + Auth + Realtime) |
| 地理数据库 | PostGIS |
| 支付 | StoreKit 2 |

### 4.2 核心代码文件

| 功能模块 | 核心文件 |
|---------|---------|
| 用户认证 | AuthManager.swift |
| 位置定位 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 物品管理 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 通讯系统 | RadioManager.swift, CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 5. 发布计划

### 5.1 版本规划

| 版本 | 功能范围 | 目标 |
|------|---------|------|
| v1.0 | 登录、圈地、探索、背包、建造 | MVP验证核心玩法 |
| v1.1 | 交易系统、通讯系统 | 增加社交互动 |
| v1.2 | 排行榜、成就系统 | 增强留存 |
| v2.0 | 内购系统、订阅 | 商业化变现 |

### 5.2 上线要求

- 通过Apple App Store审核
- 支持iOS 17及以上系统
- 完成所有P0功能
- 通过内部测试和Beta测试

---

## 6. 附录

### 6.1 术语表

| 术语 | 解释 |
|------|------|
| LBS | Location-Based Service，基于位置的服务 |
| POI | Point of Interest，兴趣点 |
| PTT | Push to Talk，按键通话 |
| OAuth | 开放授权协议 |
| PostGIS | PostgreSQL地理空间扩展 |

### 6.2 参考产品

- Pokemon GO（宝可梦GO）
- Ingress
- 饥荒/方舟/Rust（生存游戏）
